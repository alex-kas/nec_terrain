## Exploiting NEC Terrain mobile

### Introduction and terroot

The pre-story can be found in http://forum.xda-developers.com/showthread.php?t=2515602
Many useful scripts, links and the most important the unlocking app, **terroot**,  can be found in https://github.com/x29a/nec_terrain_root.
The latter is an easily traceable app which implements the method (my, in fact) outlined in
http://forum.xda-developers.com/showpost.php?p=61542922&postcount=186 (also few posts before and all way down)

#### A bit of info:

Terminology:

* *boot* - normal boot via the image on the boot partition (number 9). The kernel in this image blocks rw access to the vital system areas, like system, boot, recovery, sbl1,2,3, aboot, rpm, tz.
You cannot write there even if you are root. You moreover cannot remount those partitions rw. The physical area of the internal memory where these partitions are is also write-protected by the kernel.
* *recovery* - recovery boot (via *vol-down+power*) via the recovery partition (number 11). The kernel there is free of the write-blocks.
* *system* or *ROM* - your actual operating system, all inside /system directory

Each bootable image has kernel and the initramdisk to kick-off the system. In our story stock kernels in boot and recovery are different, clearly due to presence/absence of blocks but
the config.gz for both kernels is identical.

In order to root the phone we need to place the su binary inside /system/bin (or /system/xbin) and the goal is to open it for write. Since even root cannot do it, the new goal is to modify the boot
image where all mountings happen. But re-flashing of an image is not possible.

So, the goal is to flash it to a new place and instruct the system about this. Out of the sudden the gpt table itself is NOT protected from writing. AND, this is essential, it has holes.
Moreover, the boot locker in aboot partition (number 7) just a joke. It exists, it check certificates, hash, etc, but its logic is like that:

1. If I see a wrong image I write one byte just inside my aboot image.
2. Then I boot your wrong kernel, have it.
3. Next time, if I see that the byte from point 1 is set, I boot whatever you like w/o verification.
4. ...

Good for us, less work. As long as you can flash a modified image.

#### What is **terroot**?

1. Using the run_root_shell, which in turn uses a loop-hole in the original kernel to achieve a temporary root,
**terroot** remaps the recovery partition into another location.

2. This location is writable under a temporary root and you can flash there any image.

3. **terroot** flashes there the recovery image (the one from the directoy `recovery/` here).

4. Also it puts the boot image (the one from the directory `boot` here) into a special place on the external sd-card so that you can flash it from inside the new recovery.
 
**NOTICE** that the present version of boot image *does not* have `att.service.entitlement` set to `false`.

The latter is achieved by placing `build.prop` in place. See instructions below *how* and *when* to do this. You need this property set to `false` if you want the tethering ability.


